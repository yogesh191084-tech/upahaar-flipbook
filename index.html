<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upahaar - Flipbook</title>
<style>
  :root { --bg:#f2efe9; --card:#fff; --muted:#6b6b6b; --accent:#0b6b3a; --accent-dark:#0a5a31; }
  html,body { height:100%; margin:0; font-family:Inter, system-ui, Arial, sans-serif; background:var(--bg); }
  .wrap { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px; box-sizing:border-box; }
  .viewer { width:92vw; max-width:1100px; height:88vh; max-height:820px; background:var(--card); box-shadow:0 18px 50px rgba(0,0,0,0.12); border-radius:12px; overflow:hidden; position:relative; }
  .page { width:100%; height:100%; display:flex; align-items:center; justify-content:center; transition: transform 0.5s cubic-bezier(.2,.9,.2,1), opacity 0.45s ease; backface-visibility:hidden; position:absolute; top:0; left:0; will-change: transform, opacity; pointer-events:none; background:#fff; }
  .page img { max-width:100%; max-height:100%; display:block; border-radius:6px; box-shadow:0 6px 18px rgba(0,0,0,0.06); user-select:none; pointer-events:none; }
  .controls { position:absolute; bottom:14px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:99999; }
  .controls button { background:var(--accent-dark); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-size:14px; opacity:.96; }
  .controls button:disabled { opacity:0.35; cursor:default; }
  .counter { position:absolute; top:12px; right:12px; background:rgba(0,0,0,0.6); color:#fff; padding:6px 10px; border-radius:6px; font-size:13px; z-index:99999; }
  .sound-toggle { position:absolute; top:12px; left:12px; z-index:99999; }
  .sound-toggle button { background:transparent; color:var(--accent-dark); border:1px solid #ddd; padding:6px 10px; border-radius:6px; font-size:13px; cursor:pointer; }
  .share { position:absolute; top:12px; left:200px; display:flex; gap:8px; align-items:center; z-index:99999; }
  .share button { background:transparent; color:var(--accent-dark); border:1px solid #ddd; padding:6px 10px; border-radius:6px; font-size:13px; cursor:pointer; }
  .note { position:absolute; bottom:14px; right:14px; font-size:12px; color:var(--muted); z-index:99999; }
  .fallback { padding:20px; text-align:center; color:var(--muted); }
  .cover { position:absolute; top:0; left:0; right:0; bottom:0; background:linear-gradient(180deg,#f7fbf8,#f2efe9); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:10000; }
  .cover h1 { font-size:28px; margin:0 0 12px; color:var(--accent-dark); }
  .cover p { margin:6px 0 18px; color:var(--muted); }
  .cover button { background:var(--accent); color:#fff; padding:12px 20px; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
  @media (max-width:700px){ .viewer{ width:98vw; height:92vh; } .share{ left:120px; } .cover h1{ font-size:20px; } }
</style>
</head>
<body>
<div class="wrap">
  <div class="viewer" id="viewer" aria-live="polite">
    <div class="sound-toggle"><button id="soundBtn">üéµ Sound: ON</button></div>

    <div class="share" id="shareRow">
      <button id="shareWhats">WhatsApp</button>
      <button id="shareLinked">LinkedIn</button>
      <button id="shareEmail">Email</button>
      <button id="contactBtn">Contact</button>
    </div>

    <div class="counter" id="counter">0 / 0</div>

    <div class="controls" id="controls">
      <button id="prevBtn">‚óÄ Prev</button>
      <button id="nextBtn">Next ‚ñ∂</button>
    </div>

    <div class="note">Use ‚Üê ‚Üí keys to flip (click Start to enable sound)</div>

    <div class="cover" id="cover" role="dialog" aria-label="Upahaar cover">
      <h1>Upahaar ‚Äî Corporate Gifting</h1>
      <p>Interactive product catalogue ‚Äî flip through and explore.</p>
      <button id="startBtn">Start Flipbook ‚ñ∂</button>
      <p style="font-size:12px;color:var(--muted);margin-top:10px;">Clicking Start also enables gentle background music (you can mute anytime).</p>
    </div>

  </div>
</div>

<!-- Contact modal (simple) -->
<div id="modalBack" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;z-index:20000;">
  <div style="background:#fff;padding:18px;border-radius:10px;max-width:700px;width:92%;box-shadow:0 12px 40px rgba(0,0,0,0.18);">
    <h3 style="margin:0 0 8px;color:var(--accent-dark)">Contact Upahaar</h3>
    <p style="margin:0 0 12px;color:#333">Reach out for corporate gifts and enquiries:</p>
    <div style="margin-bottom:8px;">üåê <a href="https://www.uphaarcorporategifts.com" target="_blank">www.uphaarcorporategifts.com</a></div>
    <div style="margin-bottom:8px;">‚úâÔ∏è <a href="mailto:sales@upahaarcorporategifts.com">sales@upahaarcorporategifts.com</a></div>
    <div style="margin-bottom:8px;">üìû WhatsApp: <a href="https://api.whatsapp.com/send?phone=919145593366" target="_blank">+91 9145593366</a></div>
    <div style="text-align:right;"><button id="closeModal" style="padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer;">Close</button></div>
  </div>
</div>

<script>
/*
  Full flipbook + continuous synthesized ambient pad + flute motif + chime.
  - All audio synthesized with WebAudio (no copyrighted samples).
  - Ambient pad + flute start after user clicks Start (satisfies autoplay policy).
  - Sound toggle mutes/unmutes smoothly.
*/

(function(){
  /* --- DOM elements --- */
  const viewer = document.getElementById('viewer');
  const counter = document.getElementById('counter');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const soundBtn = document.getElementById('soundBtn');
  const startBtn = document.getElementById('startBtn');
  const cover = document.getElementById('cover');
  const shareWhats = document.getElementById('shareWhats');
  const shareLinked = document.getElementById('shareLinked');
  const shareEmail = document.getElementById('shareEmail');
  const contactBtn = document.getElementById('contactBtn');
  const modalBack = document.getElementById('modalBack');
  const closeModal = document.getElementById('closeModal');

  /* --- page probing --- */
  const maxProbe = 120;
  const pad = n => String(n).padStart(3,'0');
  function probeImages(maxN){
    return new Promise((resolve)=>{
      const found=[]; let checked=0;
      for(let i=1;i<=maxN;i++){
        const src = `pages/page_${pad(i)}.png`;
        const img = new Image();
        img.onload = ()=>{ found.push(src); done(); };
        img.onerror = ()=>{ done(); };
        img.src = src + '?_=' + Date.now() + Math.floor(Math.random()*1000);
      }
      function done(){ checked++; if(checked>=maxN){ found.sort(); resolve(found);} }
    });
  }

  /* --- audio engine state --- */
  let audioCtx = null;
  let masterGain = null;
  let padNodes = null;
  let fluteScheduler = null;
  let soundOn = true;

  /* --- create continuous ambient pad + flute motif --- */
  function ensureAudio(){
    if(audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // master gain controls overall loudness (muting done by changing this)
    masterGain = audioCtx.createGain();
    masterGain.gain.value = 0.22; // slightly louder than before but still subtle
    masterGain.connect(audioCtx.destination);

    // === Ambient pad ===
    // two detuned sines -> lowpass filter -> master
    const o1 = audioCtx.createOscillator();
    o1.type = 'sine'; o1.frequency.value = 110; // low base
    const o2 = audioCtx.createOscillator();
    o2.type = 'sine'; o2.frequency.value = 110 * 1.003; // tiny detune for width

    const g1 = audioCtx.createGain(); g1.gain.value = 0.06;
    const g2 = audioCtx.createGain(); g2.gain.value = 0.05;

    const padFilter = audioCtx.createBiquadFilter(); padFilter.type = 'lowpass'; padFilter.frequency.value = 700;

    // subtle LFO to move the pad filter slowly
    const lfo = audioCtx.createOscillator(); lfo.type='sine'; lfo.frequency.value=0.02;
    const lfoGain = audioCtx.createGain(); lfoGain.gain.value = 360; // amount of sweep
    lfo.connect(lfoGain); lfoGain.connect(padFilter.frequency);

    o1.connect(g1); o2.connect(g2);
    g1.connect(padFilter); g2.connect(padFilter);
    padFilter.connect(masterGain);

    // start pad oscillators and LFO
    o1.start(); o2.start(); lfo.start();

    // smooth fade-in of pad
    g1.gain.setValueAtTime(0.0001,audioCtx.currentTime);
    g1.gain.linearRampToValueAtTime(0.06,audioCtx.currentTime+1.6);
    g2.gain.setValueAtTime(0.0001,audioCtx.currentTime);
    g2.gain.linearRampToValueAtTime(0.05,audioCtx.currentTime+1.7);

    // === Flute-like motif (synthesized) ===
    // We'll implement a small scheduler that triggers gentle flute notes repeatedly.
    // Flute voice = bandpassed oscillator + breath noise
    function playFluteNote(freq,dur=1.2, amp=0.06){
      if(!audioCtx) return;
      const now = audioCtx.currentTime;
      // breath: noise buffer + bandpass -> small transient
      const bufferSize = Math.floor(audioCtx.sampleRate * 0.2);
      const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const data = noiseBuffer.getChannelData(0);
      for(let i=0;i<bufferSize;i++) data[i] = (Math.random()*2 - 1) * Math.exp(-6*i/bufferSize);
      const nb = audioCtx.createBufferSource(); nb.buffer = noiseBuffer;
      const breathFilter = audioCtx.createBiquadFilter(); breathFilter.type='bandpass'; breathFilter.frequency.value = Math.max(700, freq*2.5);
      const breathGain = audioCtx.createGain(); breathGain.gain.setValueAtTime(amp*0.6, now);
      breathGain.gain.exponentialRampToValueAtTime(0.0001, now + 0.18);
      nb.connect(breathFilter).connect(breathGain).connect(masterGain);
      nb.start(now); nb.stop(now + 0.2);

      // tone: oscillator with small vibrato
      const osc = audioCtx.createOscillator(); osc.type = 'sine';
      const oscGain = audioCtx.createGain(); oscGain.gain.setValueAtTime(0.0001, now);
      // filter to make it "flute-like"
      const bp = audioCtx.createBiquadFilter(); bp.type = 'bandpass'; bp.Q = 6; bp.frequency.value = freq * 1.0;

      // vibrato LFO
      const vLFO = audioCtx.createOscillator(); vLFO.type='sine'; vLFO.frequency.value = 5.2;
      const vGain = audioCtx.createGain(); vGain.gain.value = freq * 0.0035; // small pitch wobble
      vLFO.connect(vGain);
      vGain.connect(osc.frequency);

      osc.connect(bp).connect(oscGain).connect(masterGain);

      // amplitude envelope
      oscGain.gain.setValueAtTime(0.0001, now);
      oscGain.gain.linearRampToValueAtTime(amp, now + 0.04);
      oscGain.gain.exponentialRampToValueAtTime(0.0001, now + dur);

      vLFO.start(now);
      osc.start(now);
      // stop nodes later
      osc.stop(now + dur + 0.05);
      vLFO.stop(now + dur + 0.05);
    }

    // Simple melodic pattern (arpeggiated-ish) ‚Äî gentle, not busy
    const melody = [440, 392, 330, 392, 440, 0, 440, 494]; // some notes (Hz). '0' = short rest
    let idx = 0;
    const motifInterval = 1600; // ms between motif steps
    fluteScheduler = setInterval(()=>{
      const f = melody[idx % melody.length];
      if(f > 0) playFluteNote(f, 1.1, 0.048); // freq,duration,amp
      idx++;
    }, motifInterval);

    padNodes = { o1,o2,g1,g2,padFilter,lfo,lfoGain:lfoGain };
  }

  /* --- gentle page flip chime --- */
  function playChime(){
    if(!audioCtx || !soundOn) return;
    try{
      const ctx = audioCtx;
      const now = ctx.currentTime;
      const freqs = [720, 1080]; // pleasant harmonic interval
      freqs.forEach((f,i)=>{
        const o = ctx.createOscillator();
        o.type = 'triangle';
        o.frequency.setValueAtTime(f, now);
        const g = ctx.createGain();
        g.gain.setValueAtTime(0.0001, now);
        g.gain.linearRampToValueAtTime(0.06 * (i===0?1:0.55), now + 0.008);
        g.gain.exponentialRampToValueAtTime(0.0001, now + 0.45 + i*0.04);
        o.connect(g).connect(masterGain);
        o.start(now);
        o.stop(now + 0.6 + i*0.04);
      });
      // short soft noise transient for "paper" feel
      const bufSize = ctx.sampleRate * 0.12;
      const nb = ctx.createBuffer(1, bufSize, ctx.sampleRate);
      const data = nb.getChannelData(0);
      for(let i=0;i<bufSize;i++) data[i] = (Math.random()*2-1) * Math.exp(-4*i/bufSize);
      const src = ctx.createBufferSource(); src.buffer = nb;
      const nf = ctx.createBiquadFilter(); nf.type='lowpass'; nf.frequency.value = 1500;
      const ng = ctx.createGain(); ng.gain.setValueAtTime(0.08, now);
      ng.gain.exponentialRampToValueAtTime(0.0001, now + 0.12);
      src.connect(nf).connect(ng).connect(masterGain);
      src.start(now); src.stop(now + 0.14);
    }catch(e){ console.log('chime err', e); }
  }

  /* --- sound toggle (mute/unmute) --- */
  soundBtn.addEventListener('click', ()=>{
    if(!audioCtx){ // if user toggles before Start, just init to let them enable sound
      try{ ensureAudio(); if(audioCtx.state === 'suspended') audioCtx.resume(); }catch(e){console.log(e);}
    }
    soundOn = !soundOn;
    if(!masterGain) return;
    if(!soundOn){
      masterGain.gain.cancelScheduledValues(audioCtx.currentTime);
      masterGain.gain.setValueAtTime(masterGain.gain.value, audioCtx.currentTime);
      masterGain.gain.linearRampToValueAtTime(0.0001, audioCtx.currentTime + 0.6);
      soundBtn.textContent = 'üîá Sound: OFF';
    } else {
      masterGain.gain.cancelScheduledValues(audioCtx.currentTime);
      masterGain.gain.setValueAtTime(0.0001, audioCtx.currentTime);
      masterGain.gain.linearRampToValueAtTime(0.22, audioCtx.currentTime + 0.8);
      soundBtn.textContent = 'üéµ Sound: ON';
    }
  });

  /* --- basic UI: probe images and setup pages --- */
  async function initPages(){
    const images = await probeImages(maxProbe);
    if(!images || images.length === 0){
      viewer.innerHTML = '<div class="fallback"><h3>No pages found</h3><p>Make sure there is a <code>pages/</code> folder with page_###.png files.</p></div>';
      return;
    }
    // create page elements in order
    images.forEach((src,i)=>{
      const el = document.createElement('div');
      el.className = 'page';
      el.dataset.idx = i;
      el.style.zIndex = 100 + (images.length - i);
      const img = document.createElement('img'); img.src = src; img.alt = 'Page ' + (i+1);
      el.appendChild(img);
      viewer.appendChild(el);
    });

    const pages = Array.from(document.querySelectorAll('.page'));
    let current = 0;

    function updateUI(playSound = true){
      pages.forEach((p,i)=>{
        p.style.zIndex = (i===current) ? 999 : (100 + (pages.length - i));
        if(i < current){ p.style.transform = 'translateX(-140%) scale(.98)'; p.style.opacity='0'; p.style.pointerEvents='none'; }
        else if(i === current){ p.style.transform = 'translateX(0) scale(1)'; p.style.opacity='1'; p.style.pointerEvents='auto'; }
        else { p.style.transform = 'translateX(140%) scale(.98)'; p.style.opacity='0'; p.style.pointerEvents='none'; }
      });
      counter.textContent = (current+1) + ' / ' + pages.length;
      prevBtn.disabled = current === 0;
      nextBtn.disabled = current === pages.length - 1;
      if(playSound) playChime();
      window.current = current;
      // if last page, you might show contact ‚Äî but we keep it simple
    }

    window.showPage = function(n){
      current = Math.max(0, Math.min(pages.length-1, n));
      updateUI(true);
    };

    prevBtn.onclick = () => showPage((window.current||0)-1);
    nextBtn.onclick = () => showPage((window.current||0)+1);

    document.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowLeft') showPage((window.current||0)-1);
      if(e.key === 'ArrowRight') showPage((window.current||0)+1);
    });

    // if page param provided, open there
    const pParam = new URLSearchParams(window.location.search).get('p');
    if(pParam){ const p = parseInt(pParam,10); if(!isNaN(p)) current = Math.max(0, Math.min(pages.length-1, p-1)); }
    updateUI(false);
  }

  /* --- Start button behavior: init audio and pages --- */
  startBtn.addEventListener('click', ()=>{
    try{
      ensureAudio();
      if(audioCtx.state === 'suspended') audioCtx.resume();
    }catch(e){ console.log('audio init', e); }
    cover.style.display = 'none';
    // init pages after cover removed (so progress visible)
    initPages();
  });

  /* --- share handlers --- */
  function shareUrlWithPage(){
    const base = window.location.href.split('?')[0];
    const p = (typeof window.current === 'number') ? (window.current + 1) : 1;
    return base + '?p=' + p;
  }
  shareWhats.addEventListener('click', ()=> {
    window.open('https://api.whatsapp.com/send?text=' + encodeURIComponent('Flip through Upahaar catalogue: ' + shareUrlWithPage()), '_blank');
  });
  shareLinked.addEventListener('click', ()=> {
    window.open('https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(shareUrlWithPage()), '_blank');
  });
  shareEmail.addEventListener('click', ()=> {
    window.location.href = 'mailto:?subject=' + encodeURIComponent('Upahaar Catalogue') + '&body=' + encodeURIComponent('Check this Upahaar catalogue: ' + shareUrlWithPage());
  });

  /* --- contact modal --- */
  contactBtn.addEventListener('click', ()=>{ modalBack.style.display='flex'; });
  closeModal && closeModal.addEventListener('click', ()=>{ modalBack.style.display='none'; });
  modalBack && modalBack.addEventListener('click', (e)=>{ if(e.target===modalBack) modalBack.style.display='none'; });

  /* --- If user opens specific page link directly, auto-hide cover and load at that page (but keep audio off until Start) --- */
  (async function precheck(){
    const params = new URLSearchParams(window.location.search);
    const p = parseInt(params.get('p')||'0',10);
    if(p && !isNaN(p)){
      // hide cover but do not start audio automatically
      cover.style.display = 'none';
      await initPages();
      // go to requested page (showPage will be available after initPages)
      if(typeof window.showPage === 'function') window.showPage(p-1);
    }
  })();

})();
</script>
</body>
</html>
