<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upahaar - Flipbook</title>
<style>
  :root { --bg:#f2efe9; --card:#fff; --muted:#6b6b6b; --accent:#0b6b3a; --accent-dark:#0a5a31; }
  html,body { height:100%; margin:0; font-family:Inter, system-ui, Arial, sans-serif; background:var(--bg); }
  .wrap { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px; box-sizing:border-box; }
  .viewer { width:92vw; max-width:1100px; height:88vh; max-height:820px; background:var(--card); box-shadow:0 18px 50px rgba(0,0,0,0.12); border-radius:12px; overflow:hidden; position:relative; }
  .page { width:100%; height:100%; display:flex; align-items:center; justify-content:center; transition:transform .5s ease,opacity .45s ease; position:absolute; top:0; left:0; pointer-events:none; background:#fff; }
  .page img { max-width:100%; max-height:100%; border-radius:6px; user-select:none; }
  .controls { position:absolute; bottom:14px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:99; }
  .controls button { background:var(--accent-dark); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-size:14px; }
  .controls button:disabled { opacity:.35; cursor:default; }
  .counter { position:absolute; top:12px; right:12px; background:rgba(0,0,0,.6); color:#fff; padding:6px 10px; border-radius:6px; font-size:13px; z-index:99; }
  .sound-toggle { position:absolute; top:12px; left:12px; z-index:99; }
  .sound-toggle button { background:transparent; color:var(--accent-dark); border:1px solid #ddd; padding:6px 10px; border-radius:6px; font-size:13px; cursor:pointer; }
  .share { position:absolute; top:12px; left:120px; display:flex; gap:8px; z-index:99; }
  .share button { background:transparent; color:var(--accent-dark); border:1px solid #ddd; padding:6px 10px; border-radius:6px; font-size:13px; cursor:pointer; }
  .note { position:absolute; bottom:14px; right:14px; font-size:12px; color:var(--muted); z-index:99; }
  .cover { position:absolute; inset:0; background:linear-gradient(180deg,#f7fbf8,#f2efe9); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:1000; }
  .cover h1 { font-size:28px; margin:0 0 12px; color:var(--accent-dark); }
  .cover p { margin:6px 0 18px; color:var(--muted); }
  .cover button { background:var(--accent); color:#fff; padding:12px 20px; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>
<div class="wrap">
  <div class="viewer" id="viewer">
    <div class="sound-toggle"><button id="soundBtn">üéµ Sound: ON</button></div>
    <div class="share">
      <button id="shareWhats">WhatsApp</button>
      <button id="shareLinked">LinkedIn</button>
      <button id="shareEmail">Email</button>
    </div>
    <div class="counter" id="counter">0 / 0</div>
    <div class="controls">
      <button id="prevBtn">‚óÄ Prev</button>
      <button id="nextBtn">Next ‚ñ∂</button>
    </div>
    <div class="note">Use ‚Üê ‚Üí keys to flip. Click Start to enable music.</div>
    <div class="cover" id="cover">
      <h1>Upahaar ‚Äî Corporate Gifting</h1>
      <p>Interactive catalogue ‚Äî click Start to explore (gentle music plays)</p>
      <button id="startBtn">Start Flipbook ‚ñ∂</button>
    </div>
  </div>
</div>

<script>
(function(){
  const viewer=document.getElementById('viewer');
  const counter=document.getElementById('counter');
  const prevBtn=document.getElementById('prevBtn');
  const nextBtn=document.getElementById('nextBtn');
  const soundBtn=document.getElementById('soundBtn');
  const shareWhats=document.getElementById('shareWhats');
  const shareLinked=document.getElementById('shareLinked');
  const shareEmail=document.getElementById('shareEmail');
  const cover=document.getElementById('cover');
  const startBtn=document.getElementById('startBtn');

  const TOTAL_PAGES=80;
  const pad=n=>String(n).padStart(3,'0');

  let audioCtx, masterGain, soundOn=true;

  function initMusic(){
    if(audioCtx) return;
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    masterGain=audioCtx.createGain();
    masterGain.gain.value=0.9;
    masterGain.connect(audioCtx.destination);

    // Pad
    const pad1=audioCtx.createOscillator(); pad1.type='sine'; pad1.frequency.value=110;
    const pad2=audioCtx.createOscillator(); pad2.type='triangle'; pad2.frequency.value=111;
    const g1=audioCtx.createGain(); g1.gain.value=0.03;
    const g2=audioCtx.createGain(); g2.gain.value=0.025;
    const filt=audioCtx.createBiquadFilter(); filt.type='lowpass'; filt.frequency.value=900;
    pad1.connect(g1).connect(filt); pad2.connect(g2).connect(filt); filt.connect(masterGain);
    pad1.start(); pad2.start();

    // Marimba-like notes
    function playNote(freq,t){
      const o=audioCtx.createOscillator(); o.type='sine'; o.frequency.value=freq;
      const g=audioCtx.createGain();
      g.gain.setValueAtTime(0.0001,t);
      g.gain.linearRampToValueAtTime(0.08,t+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001,t+1.0);
      const bp=audioCtx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=freq*2.5; bp.Q=6;
      o.connect(bp).connect(g).connect(masterGain);
      o.start(t); o.stop(t+1.2);
    }

    // Rhythm: soft pulse + sequence
    let idx=0; const seq=[440,392,330,349,392,440,523,440];
    const bpm=70, step=60/bpm; let next=audioCtx.currentTime+0.1;
    function loop(){
      const now=audioCtx.currentTime;
      while(next<now+3){
        playNote(seq[idx%seq.length],next+0.05);
        idx++; next+=step;
      }
    }
    setInterval(loop,500);
  }

  function playFlipChime(){
    if(!audioCtx||!soundOn) return;
    const now=audioCtx.currentTime;
    const o=audioCtx.createOscillator(); o.type='triangle'; o.frequency.value=880;
    const g=audioCtx.createGain(); g.gain.setValueAtTime(0.06,now);
    g.gain.exponentialRampToValueAtTime(0.0001,now+0.4);
    o.connect(g).connect(masterGain); o.start(now); o.stop(now+0.5);
  }

  soundBtn.onclick=()=>{
    if(!audioCtx) initMusic();
    soundOn=!soundOn;
    masterGain.gain.setTargetAtTime(soundOn?0.9:0.0001,audioCtx.currentTime,0.3);
    soundBtn.textContent=soundOn?'üéµ Sound: ON':'üîá Sound: OFF';
  };

  function initPages(){
    for(let i=1;i<=TOTAL_PAGES;i++){
      const el=document.createElement('div'); el.className='page'; el.dataset.idx=i-1;
      el.style.zIndex=100+(TOTAL_PAGES-i);
      const img=document.createElement('img'); img.src=`pages/page_${pad(i)}.png`; img.alt='Page '+i;
      el.appendChild(img); viewer.appendChild(el);
    }
    const pages=[...document.querySelectorAll('.page')]; let current=0;
    function updateUI(play=true){
      pages.forEach((p,i)=>{
        if(i<current){p.style.transform='translateX(-130%)';p.style.opacity='0';}
        else if(i===current){p.style.transform='translateX(0)';p.style.opacity='1';}
        else{p.style.transform='translateX(130%)';p.style.opacity='0';}
      });
      counter.textContent=(current+1)+' / '+pages.length;
      prevBtn.disabled=current===0; nextBtn.disabled=current===pages.length-1;
      if(play) playFlipChime();
      window.current=current;
    }
    window.showPage=n=>{current=Math.max(0,Math.min(pages.length-1,n)); updateUI(true);};
    prevBtn.onclick=()=>showPage((window.current||0)-1);
    nextBtn.onclick=()=>showPage((window.current||0)+1);
    document.addEventListener('keydown',e=>{if(e.key==='ArrowLeft')showPage(window.current-1);if(e.key==='ArrowRight')showPage(window.current+1);});
    updateUI(false);
  }

  startBtn.onclick=async()=>{
    initMusic(); await audioCtx.resume();
    cover.style.display='none'; initPages();
  };

  function shareUrl(){const base=location.href.split('?')[0];const p=(window.current||0)+1;return base+'?p='+p;}
  shareWhats.onclick=()=>window.open('https://wa.me/?text='+encodeURIComponent('Flip through Upahaar catalogue: '+shareUrl()),'_blank');
  shareLinked.onclick=()=>window.open('https://www.linkedin.com/sharing/share-offsite/?url='+encodeURIComponent(shareUrl()),'_blank');
  shareEmail.onclick=()=>location.href='mailto:?subject=Upahaar Catalogue&body='+encodeURIComponent('Hi ‚Äî check this: '+shareUrl());
})();
</script>
</body>
</html>
