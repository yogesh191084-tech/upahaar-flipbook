<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upahaar - Flipbook</title>
<style>
  :root { --bg:#f2efe9; --card:#fff; --muted:#6b6b6b; --accent:#0b6b3a; --accent-dark:#0a5a31; }
  html,body { height:100%; margin:0; font-family:Inter, system-ui, Arial, sans-serif; background:var(--bg); }
  .wrap { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px; box-sizing:border-box; }
  .viewer { width:92vw; max-width:1100px; height:88vh; max-height:820px; background:var(--card); box-shadow:0 18px 50px rgba(0,0,0,0.12); border-radius:12px; overflow:hidden; position:relative; }
  .page { width:100%; height:100%; display:flex; align-items:center; justify-content:center; transition:transform .5s ease,opacity .45s ease; position:absolute; top:0; left:0; pointer-events:none; background:#fff; }
  .page img { max-width:100%; max-height:100%; border-radius:6px; user-select:none; }
  .controls { position:absolute; bottom:14px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:99; }
  .controls button { background:var(--accent-dark); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-size:14px; }
  .controls button:disabled { opacity:.35; cursor:default; }
  .counter { position:absolute; top:12px; right:12px; background:rgba(0,0,0,.6); color:#fff; padding:6px 10px; border-radius:6px; font-size:13px; z-index:99; }
  .sound-toggle { position:absolute; top:12px; left:12px; z-index:99; }
  .sound-toggle button { background:transparent; color:var(--accent-dark); border:1px solid #ddd; padding:6px 10px; border-radius:6px; font-size:13px; cursor:pointer; }
  .share { position:absolute; top:12px; left:120px; display:flex; gap:8px; z-index:99; }
  .share button { background:transparent; color:var(--accent-dark); border:1px solid #ddd; padding:6px 10px; border-radius:6px; font-size:13px; cursor:pointer; }
  .note { position:absolute; bottom:14px; right:14px; font-size:12px; color:var(--muted); z-index:99; }
  .cover { position:absolute; inset:0; background:linear-gradient(180deg,#f7fbf8,#f2efe9); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:1000; }
  .cover h1 { font-size:28px; margin:0 0 12px; color:var(--accent-dark); }
  .cover p { margin:6px 0 18px; color:var(--muted); }
  .cover button { background:var(--accent); color:#fff; padding:12px 20px; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>
<div class="wrap">
  <div class="viewer" id="viewer">
    <div class="sound-toggle"><button id="soundBtn">üéµ Sound: ON</button></div>
    <div class="share">
      <button id="shareWhats">WhatsApp</button>
      <button id="shareLinked">LinkedIn</button>
      <button id="shareEmail">Email</button>
    </div>
    <div class="counter" id="counter">0 / 0</div>
    <div class="controls">
      <button id="prevBtn">‚óÄ Prev</button>
      <button id="nextBtn">Next ‚ñ∂</button>
    </div>
    <div class="note">Use ‚Üê ‚Üí keys to flip. Click Start to enable music.</div>
    <div class="cover" id="cover">
      <h1>Upahaar ‚Äî Corporate Gifting</h1>
      <p>Interactive catalogue ‚Äî click Start to explore (gentle music plays)</p>
      <button id="startBtn">Start Flipbook ‚ñ∂</button>
    </div>
  </div>
</div>

<script>
/* Full robust audio + pages script.
   - Creates AudioContext on Start (user gesture)
   - Starts a pleasant repeating marimba+pad pattern (slightly louder)
   - Keeps all UI exactly the same
*/

(function(){
  const viewer = document.getElementById('viewer');
  const counter = document.getElementById('counter');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const soundBtn = document.getElementById('soundBtn');
  const shareWhats = document.getElementById('shareWhats');
  const shareLinked = document.getElementById('shareLinked');
  const shareEmail = document.getElementById('shareEmail');
  const cover = document.getElementById('cover');
  const startBtn = document.getElementById('startBtn');

  const TOTAL_PAGES = 80;
  const pad = n => String(n).padStart(3,'0');

  // AUDIO variables
  let audioCtx = null;
  let masterGain = null;
  let running = false;
  let soundOn = true;
  let schedInterval = null;

  function createAudioGraph(){
    if(audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.gain.value = 1.0; // slightly increased default volume
    masterGain.connect(audioCtx.destination);

    // pad oscillators (soft)
    const padA = audioCtx.createOscillator(); padA.type='sine'; padA.frequency.value = 110;
    const padB = audioCtx.createOscillator(); padB.type='triangle'; padB.frequency.value = 110 * 1.002;
    const gA = audioCtx.createGain(); gA.gain.value = 0.035;
    const gB = audioCtx.createGain(); gB.gain.value = 0.03;
    const lp = audioCtx.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value = 900;
    padA.connect(gA).connect(lp); padB.connect(gB).connect(lp); lp.connect(masterGain);
    padA.start(); padB.start();

    // small low thump for rhythm
    const subOsc = audioCtx.createOscillator(); subOsc.type='sine'; subOsc.frequency.value=60;
    const subGain = audioCtx.createGain(); subGain.gain.value=0.0001;
    subOsc.connect(subGain).connect(masterGain);
    subOsc.start();

    // marimba-like function
    function playMarimba(freq, t, dur=1.0, vel=0.09){
      const o = audioCtx.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(freq, t);
      const g = audioCtx.createGain(); g.gain.setValueAtTime(0.0001, t);
      g.gain.linearRampToValueAtTime(vel, t + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t + dur);
      const bp = audioCtx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value = freq * 2.5; bp.Q = 6;
      o.connect(bp).connect(g).connect(masterGain);
      o.start(t); o.stop(t + dur + 0.05);
    }

    // small click to add texture
    function playClick(t){
      const size = Math.floor(audioCtx.sampleRate * 0.03);
      const buffer = audioCtx.createBuffer(1, size, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      for(let i=0;i<size;i++) data[i] = (Math.random()*2-1) * Math.exp(-5*i/size);
      const src = audioCtx.createBufferSource(); src.buffer = buffer;
      const hf = audioCtx.createBiquadFilter(); hf.type='highpass'; hf.frequency.value = 800;
      const g = audioCtx.createGain(); g.gain.setValueAtTime(0.06, t); g.gain.exponentialRampToValueAtTime(0.0001, t + 0.12);
      src.connect(hf).connect(g).connect(masterGain);
      src.start(t); src.stop(t + 0.13);
    }

    // sequencer scheduling
    let idx = 0;
    const seq = [440, 392, 330, 349, 392, 440, 523, 440]; // pleasant melodic loop
    const bpm = 72;
    const step = 60 / bpm;
    let nextT = audioCtx.currentTime + 0.1;

    function scheduler(){
      const now = audioCtx.currentTime;
      while(nextT < now + 2.5){
        // marimba note
        playMarimba(seq[idx % seq.length], nextT + 0.04, 0.9, 0.085);
        // click slightly after beat
        playClick(nextT + 0.06);
        // subtle sub pulse envelope via master gain (momentary)
        // create a short gain bump
        // we'll emulate by quickly increasing masterGain via setTargetAtTime (subtle).
        // (masterGain used here is global; avoid extreme changes)
        nextT += step;
        idx++;
      }
    }
    // run scheduler actively
    schedInterval = setInterval(scheduler, 400);
    // initial run
    scheduler();
  }

  function stopAudio(){
    if(schedInterval) { clearInterval(schedInterval); schedInterval = null; }
    // we don't stop oscillators because they're used as pad; we lower volume
    if(masterGain) masterGain.gain.setTargetAtTime(0.0001, audioCtx.currentTime, 0.2);
    running = false;
  }

  function resumeAudioIfNeeded(){
    if(!audioCtx) return;
    if(audioCtx.state === 'suspended') audioCtx.resume();
    if(masterGain) masterGain.gain.setTargetAtTime(soundOn?1.0:0.0001, audioCtx.currentTime, 0.05);
  }

  // small flip chime
  function playFlip(){
    if(!audioCtx || !soundOn) return;
    const now = audioCtx.currentTime;
    const o = audioCtx.createOscillator(); o.type='triangle'; o.frequency.setValueAtTime(880, now);
    const g = audioCtx.createGain(); g.gain.setValueAtTime(0.06, now); g.gain.exponentialRampToValueAtTime(0.0001, now + 0.42);
    o.connect(g).connect(masterGain);
    o.start(now); o.stop(now + 0.45);
  }

  // sound toggle handler
  soundBtn.addEventListener('click', () => {
    if(!audioCtx) { createAudioGraph(); } // create graph even if toggled earlier
    soundOn = !soundOn;
    if(masterGain) masterGain.gain.setTargetAtTime(soundOn?1.0:0.0001, audioCtx.currentTime, 0.2);
    soundBtn.textContent = soundOn ? 'üéµ Sound: ON' : 'üîá Sound: OFF';
    if(soundOn && audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
  });

  // pages creation and navigation
  function initPages(){
    for(let i=1;i<=TOTAL_PAGES;i++){
      const el = document.createElement('div'); el.className = 'page'; el.dataset.idx = i-1;
      el.style.zIndex = 100 + (TOTAL_PAGES - i);
      const img = document.createElement('img'); img.src = `pages/page_${pad(i)}.png`; img.alt = 'Page '+i;
      el.appendChild(img); viewer.appendChild(el);
    }
    const pages = Array.from(document.querySelectorAll('.page'));
    let current = 0;
    function update(play=true){
      pages.forEach((p,i)=>{
        if(i<current){ p.style.transform='translateX(-130%)'; p.style.opacity='0'; p.style.pointerEvents='none'; }
        else if(i===current){ p.style.transform='translateX(0)'; p.style.opacity='1'; p.style.pointerEvents='auto'; }
        else { p.style.transform='translateX(130%)'; p.style.opacity='0'; p.style.pointerEvents='none'; }
      });
      counter.textContent = (current+1) + ' / ' + pages.length;
      prevBtn.disabled = current === 0;
      nextBtn.disabled = current === pages.length-1;
      if(play) playFlip();
      window.current = current;
    }
    window.showPage = function(n){ current = Math.max(0, Math.min(pages.length-1, n)); update(true); };
    prevBtn.onclick = ()=> showPage((window.current||0)-1);
    nextBtn.onclick = ()=> showPage((window.current||0)+1);
    document.addEventListener('keydown', e=>{ if(e.key==='ArrowLeft') showPage(window.current-1); if(e.key==='ArrowRight') showPage(window.current+1); });
    update(false);
  }

  // start click: initialize audio & pages
  startBtn.addEventListener('click', async ()=>{
    if(!audioCtx){
      createAudioGraph();
      try { await audioCtx.resume(); } catch(e){ console.log('resume error',e); }
      masterGain.gain.setTargetAtTime(soundOn?1.0:0.0001, audioCtx.currentTime, 0.02);
    } else {
      resumeAudioIfNeeded();
    }
    cover.style.display = 'none';
    initPages();
  });

  // simple share handlers
  function shareUrl(){ const base = window.location.href.split('?')[0]; const p=(window.current||0)+1; return base+'?p='+p; }
  shareWhats.addEventListener('click', ()=> window.open('https://wa.me/?text=' + encodeURIComponent('Flip through Upahaar catalogue: ' + shareUrl()), '_blank'));
  shareLinked.addEventListener('click', ()=> window.open('https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(shareUrl()), '_blank'));
  shareEmail.addEventListener('click', ()=> window.location.href = 'mailto:?subject=' + encodeURIComponent('Upahaar Catalogue') + '&body=' + encodeURIComponent('Hi ‚Äî check this Upahaar catalogue: ' + shareUrl()));

})();
</script>
</body>
</html>
