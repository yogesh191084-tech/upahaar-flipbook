<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upahaar - Flipbook</title>
<style>
  :root { --bg:#f2efe9; --card:#fff; --muted:#6b6b6b; --accent:#0b6b3a; --accent-dark:#0a5a31; }
  html,body { height:100%; margin:0; font-family:Inter, system-ui, Arial, sans-serif; background:var(--bg); }
  .wrap { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px; box-sizing:border-box; }
  .viewer { width:92vw; max-width:1100px; height:88vh; max-height:820px; background:var(--card); box-shadow:0 18px 50px rgba(0,0,0,0.12); border-radius:12px; overflow:hidden; position:relative; }
  .page { width:100%; height:100%; display:flex; align-items:center; justify-content:center; transition: transform 0.5s ease, opacity 0.45s ease; backface-visibility:hidden; position:absolute; top:0; left:0; pointer-events:none; background:#fff; }
  .page img { max-width:100%; max-height:100%; display:block; border-radius:6px; box-shadow:0 6px 18px rgba(0,0,0,0.06); user-select:none; }
  .controls { position:absolute; bottom:14px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:99; }
  .controls button { background:var(--accent-dark); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-size:14px; }
  .controls button:disabled { opacity:0.35; cursor:default; }
  .counter { position:absolute; top:12px; right:12px; background:rgba(0,0,0,0.6); color:#fff; padding:6px 10px; border-radius:6px; font-size:13px; z-index:99; }
  .sound-toggle { position:absolute; top:12px; left:12px; z-index:99; }
  .sound-toggle button { background:transparent; color:var(--accent-dark); border:1px solid #ddd; padding:6px 10px; border-radius:6px; font-size:13px; cursor:pointer; }
  .note { position:absolute; bottom:14px; right:14px; font-size:12px; color:var(--muted); z-index:99; }
  .cover { position:absolute; inset:0; background:linear-gradient(180deg,#f7fbf8,#f2efe9); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:1000; }
  .cover h1 { font-size:28px; margin:0 0 12px; color:var(--accent-dark); }
  .cover p { margin:6px 0 18px; color:var(--muted); }
  .cover button { background:var(--accent); color:#fff; padding:12px 20px; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>
<div class="wrap">
  <div class="viewer" id="viewer">
    <div class="sound-toggle"><button id="soundBtn">üéµ Sound: ON</button></div>
    <div class="counter" id="counter">0 / 0</div>
    <div class="controls"><button id="prevBtn">‚óÄ Prev</button><button id="nextBtn">Next ‚ñ∂</button></div>
    <div class="note">Use ‚Üê ‚Üí keys to flip</div>
    <div class="cover" id="cover">
      <h1>Upahaar ‚Äî Corporate Gifting</h1>
      <p>Interactive catalogue with gentle background music</p>
      <button id="startBtn">Start Flipbook ‚ñ∂</button>
    </div>
  </div>
</div>

<script>
(function(){
  const viewer=document.getElementById('viewer');
  const counter=document.getElementById('counter');
  const prevBtn=document.getElementById('prevBtn');
  const nextBtn=document.getElementById('nextBtn');
  const soundBtn=document.getElementById('soundBtn');
  const cover=document.getElementById('cover');
  const startBtn=document.getElementById('startBtn');
  const maxPages=120, pad=n=>String(n).padStart(3,'0');

  // ---- Audio ----
  let audioCtx=null, masterGain=null, soundOn=true, fluteTimer=null;
  function ensureAudio(){
    if(audioCtx) return;
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    masterGain=audioCtx.createGain(); masterGain.gain.value=0.25;
    masterGain.connect(audioCtx.destination);

    // Ambient pad
    const o1=audioCtx.createOscillator(), o2=audioCtx.createOscillator();
    o1.type='sine'; o2.type='sine'; o1.frequency.value=110; o2.frequency.value=111;
    const g1=audioCtx.createGain(), g2=audioCtx.createGain(); g1.gain.value=0.05; g2.gain.value=0.05;
    const f=audioCtx.createBiquadFilter(); f.type='lowpass'; f.frequency.value=600;
    const lfo=audioCtx.createOscillator(), lg=audioCtx.createGain(); lfo.type='sine'; lfo.frequency.value=0.02; lg.gain.value=300;
    lfo.connect(lg).connect(f.frequency);
    o1.connect(g1).connect(f); o2.connect(g2).connect(f); f.connect(masterGain);
    o1.start(); o2.start(); lfo.start();

    // Flute motif
    const melody=[440,392,330,392,440,0,523];
    let idx=0;
    fluteTimer=setInterval(()=>{
      const note=melody[idx%melody.length]; idx++;
      if(note>0) playFlute(note);
    },1800);
  }
  function playFlute(freq){
    const now=audioCtx.currentTime;
    const osc=audioCtx.createOscillator(); osc.type='sine'; osc.frequency.value=freq;
    const g=audioCtx.createGain(); g.gain.setValueAtTime(0.0001,now); g.gain.linearRampToValueAtTime(0.07,now+0.05); g.gain.exponentialRampToValueAtTime(0.0001,now+1.2);
    osc.connect(g).connect(masterGain); osc.start(now); osc.stop(now+1.3);
    // Breath noise
    const buf=audioCtx.createBuffer(1, audioCtx.sampleRate*0.2, audioCtx.sampleRate);
    const data=buf.getChannelData(0); for(let i=0;i<data.length;i++) data[i]=(Math.random()*2-1)*Math.exp(-5*i/data.length);
    const src=audioCtx.createBufferSource(); src.buffer=buf;
    const nf=audioCtx.createBiquadFilter(); nf.type='bandpass'; nf.frequency.value=freq*2; const ng=audioCtx.createGain(); ng.gain.value=0.03;
    src.connect(nf).connect(ng).connect(masterGain); src.start(now); src.stop(now+0.2);
  }
  function playChime(){
    if(!audioCtx||!soundOn) return;
    const ctx=audioCtx, now=ctx.currentTime;
    const o=ctx.createOscillator(); o.type='triangle'; o.frequency.value=800;
    const g=ctx.createGain(); g.gain.setValueAtTime(0.07,now); g.gain.exponentialRampToValueAtTime(0.0001,now+0.4);
    o.connect(g).connect(masterGain); o.start(now); o.stop(now+0.5);
  }
  soundBtn.onclick=()=>{
    if(!audioCtx) ensureAudio();
    soundOn=!soundOn;
    if(!masterGain) return;
    masterGain.gain.linearRampToValueAtTime(soundOn?0.25:0.0001,audioCtx.currentTime+0.6);
    soundBtn.textContent=soundOn?'üéµ Sound: ON':'üîá Sound: OFF';
  };

  // ---- Pages ----
  async function initPages(){
    const found=[];
    for(let i=1;i<=maxPages;i++){ found.push(`pages/page_${pad(i)}.png`); }
    found.forEach((src,i)=>{
      const el=document.createElement('div'); el.className='page'; el.dataset.idx=i;
      const img=document.createElement('img'); img.src=src; img.alt='Page '+(i+1); el.appendChild(img);
      viewer.appendChild(el);
    });
    const pages=[...document.querySelectorAll('.page')]; let current=0;
    function updateUI(play=true){
      pages.forEach((p,i)=>{
        if(i<current){p.style.transform='translateX(-130%)';p.style.opacity='0';}
        else if(i===current){p.style.transform='translateX(0)';p.style.opacity='1';}
        else{p.style.transform='translateX(130%)';p.style.opacity='0';}
      });
      counter.textContent=(current+1)+' / '+pages.length;
      prevBtn.disabled=current===0; nextBtn.disabled=current===pages.length-1;
      if(play) playChime();
      window.current=current;
    }
    window.showPage=n=>{current=Math.max(0,Math.min(pages.length-1,n));updateUI(true);};
    prevBtn.onclick=()=>showPage(current-1);
    nextBtn.onclick=()=>showPage(current+1);
    document.onkeydown=e=>{if(e.key==='ArrowLeft')showPage(current-1);if(e.key==='ArrowRight')showPage(current+1);};
    updateUI(false);
  }

  // ---- Start ----
  startBtn.onclick=()=>{
    ensureAudio(); if(audioCtx.state==='suspended') audioCtx.resume();
    cover.style.display='none'; initPages();
  };
})();
</script>
</body>
</html>
