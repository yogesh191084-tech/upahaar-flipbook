<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upahaar - Flipbook</title>
<style>
  :root { --bg:#f2efe9; --card:#fff; --muted:#6b6b6b; --accent:#222; }
  html,body { height:100%; margin:0; font-family:Inter, system-ui, Arial, sans-serif; background:var(--bg); }
  .wrap { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px; box-sizing:border-box; }
  .viewer { width:92vw; max-width:1100px; height:88vh; max-height:820px; background:var(--card); box-shadow:0 18px 50px rgba(0,0,0,0.12); border-radius:12px; overflow:hidden; position:relative; }
  .page { width:100%; height:100%; display:flex; align-items:center; justify-content:center; transition: transform 0.5s cubic-bezier(.2,.9,.2,1), opacity 0.45s ease; backface-visibility:hidden; position:absolute; top:0; left:0; will-change: transform, opacity; pointer-events:none; background:#fff; }
  .page img { max-width:100%; max-height:100%; display:block; border-radius:6px; box-shadow:0 6px 18px rgba(0,0,0,0.06); user-select:none; pointer-events:none; }
  .controls { position:absolute; bottom:14px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:99999; }
  .controls button { background:var(--accent); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-size:14px; opacity:.96; }
  .controls button:disabled { opacity:0.35; cursor:default; }
  .counter { position:absolute; top:12px; right:12px; background:rgba(0,0,0,0.6); color:#fff; padding:6px 10px; border-radius:6px; font-size:13px; z-index:99999; }
  .sound-toggle { position:absolute; top:12px; left:12px; display:flex; gap:8px; align-items:center; z-index:99999; }
  .sound-toggle button { background:transparent; color:var(--accent); border:1px solid #ddd; padding:6px 10px; border-radius:6px; font-size:13px; cursor:pointer; }
  .share { position:absolute; top:12px; left:150px; display:flex; gap:8px; align-items:center; z-index:99999; }
  .share button { background:transparent; color:var(--accent); border:1px solid #ddd; padding:6px 10px; border-radius:6px; font-size:13px; cursor:pointer; }
  .note { position:absolute; bottom:14px; right:14px; font-size:12px; color:var(--muted); z-index:99999; }
  .fallback { padding:20px; text-align:center; color:var(--muted); }
  @media (max-width:700px) { .viewer { width:98vw; height:92vh; } .controls button { padding:8px 10px; font-size:13px; } }
</style>
</head>
<body>
<div class="wrap">
  <div class="viewer" id="viewer" aria-live="polite">
    <div class="sound-toggle"><button id="soundBtn">üéµ Music: ON</button></div>
    <div class="share">
      <button id="shareWhats">WhatsApp</button>
      <button id="shareLinked">LinkedIn</button>
      <button id="shareEmail">Email</button>
    </div>
    <div class="counter" id="counter">0 / 0</div>

    <!-- pages will be injected here by script -->
    <div class="controls" id="controls">
      <button id="prevBtn">‚óÄ Prev</button>
      <button id="nextBtn">Next ‚ñ∂</button>
    </div>
    <div class="note">Use ‚Üê ‚Üí keys to flip. Click once to enable music üé∂</div>
  </div>
</div>

<script>
(function(){
  const viewer = document.getElementById('viewer');
  const counter = document.getElementById('counter');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const soundBtn = document.getElementById('soundBtn');
  const shareWhats = document.getElementById('shareWhats');
  const shareLinked = document.getElementById('shareLinked');
  const shareEmail = document.getElementById('shareEmail');

  const maxPagesProbe = 80; // we have 80 pages
  const pad = n => String(n).padStart(3, '0');

  function probePages(maxN=80) {
    return Array.from({length:maxN}, (_,i)=>`pages/page_${pad(i+1)}.png`);
  }

  function playFlipSound(){
    if(!soundOn) return;
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const ctx = audioCtx;
      const osc = ctx.createOscillator();
      const g = ctx.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(440, ctx.currentTime);
      g.gain.setValueAtTime(0.2, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
      osc.connect(g).connect(ctx.destination);
      osc.start();
      osc.stop(ctx.currentTime + 0.5);
    }catch(e){ console.log('audio err', e); }
  }

  async function init(){
    const images = probePages(maxPagesProbe);

    images.forEach((src, i)=>{
      const el = document.createElement('div');
      el.className = 'page';
      el.dataset.idx = i;
      el.style.zIndex = 100 + (images.length - i);
      const img = document.createElement('img');
      img.src = src;
      img.alt = 'Page ' + (i+1);
      el.appendChild(img);
      viewer.appendChild(el);
    });

    const pages = Array.from(document.querySelectorAll('.page'));
    let current = 0;
    window.current = 0;
    window.pages = pages;
    window.showPage = showPage;

    function updateUI(playSound=true){
      pages.forEach((p,i)=>{
        p.style.zIndex = (i === current) ? 999 : (100 + (pages.length - i));
        if(i < current) {
          p.style.transform = 'translateX(-130%) scale(.98)';
          p.style.opacity = '0';
        }
        else if(i === current) {
          p.style.transform = 'translateX(0) scale(1)';
          p.style.opacity = '1';
        }
        else {
          p.style.transform = 'translateX(130%) scale(.98)';
          p.style.opacity = '0';
        }
      });
      counter.textContent = (current+1) + ' / ' + pages.length;
      prevBtn.disabled = current === 0;
      nextBtn.disabled = current === pages.length-1;
      if(playSound) playFlipSound();
    }

    function showPage(n){
      current = Math.max(0, Math.min(pages.length - 1, n));
      window.current = current;
      updateUI(true);
    }

    prevBtn.onclick = ()=> showPage(current-1);
    nextBtn.onclick = ()=> showPage(current+1);
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowLeft') showPage(current-1);
      if(e.key === 'ArrowRight') showPage(current+1);
    });

    let soundOn = true;
    let audioCtx = null;
    soundBtn.addEventListener('click', ()=>{
      soundOn = !soundOn;
      soundBtn.textContent = soundOn ? 'üéµ Music: ON' : 'üîá Music: OFF';
      if(soundOn && audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
    });

    const pageUrl = window.location.href;
    shareWhats.addEventListener('click', ()=>{
      const txt = encodeURIComponent('Flip through Upahaar catalogue: ' + pageUrl);
      window.open('https://wa.me/?text=' + txt, '_blank');
    });
    shareLinked.addEventListener('click', ()=>{
      window.open('https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(pageUrl), '_blank');
    });
    shareEmail.addEventListener('click', ()=>{
      const subj = encodeURIComponent('Upahaar Catalogue');
      const body = encodeURIComponent('Hi, take a flip through this Upahaar catalogue: ' + pageUrl);
      window.location.href = 'mailto:?subject=' + subj + '&body=' + body;
    });

    updateUI(false);
  }
  init();
})();
</script>
</body>
</html>
